<tool id="pangolin" name="Phylogenetic Assignment of Outbreak Lineages (Pangolin)" version="@TOOL_VERSION@" profile="20.01" >
    <macros>
        <token name="@TOOL_VERSION@">2.3.8</token>
    </macros>
    <requirements>
        <requirement type="package" version="@TOOL_VERSION@">pangolin</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        pangolin
        --threads \${GALAXY_SLOTS:-1}
        $alignment
        --outfile '$outputcsv' 
        --max-ambig $max_ambig
        --min-length $min_length
        '$input1'
        #if $alignment
            && mv sequences.aln.fasta '$align1'
        #end if 
        csvtk csv2tab '$outputcsv' > '$outputtsv'
    ]]></command>
    <inputs>
      <param type="data" name="input1" format="fasta" label="Input FASTA File(s)" /> 
      <param name="alignment" type="boolean" label="Generate output alignment" 
            truevalue="--alignment" falsevalue="" /> 
      <param argument="--max-ambig" type="float" label="Maximum proportion of Ns allowed" 
          value="0.5" min="0" max="1" help="Maximum proportion of Ns allowed for pangolin to attempt assignment" />
      <param argument="--min-length" type="integer" label="Minimum query length allowed" 
          value="10000" min="0" help="Minimum query length allowed for pangolin to attempt assignment"/>
    </inputs>
    <outputs>
      <data name="outputtsv" format="tsv" label="pangolin on ${on_string} tsv" />
      <data name="outputcsv" format="csv" label="pangolin on ${on_string} csv" />
      <data name="align1" format="fasta" label="pangolin alignment on ${on_string}">
        <filter>alignment == True</filter>
      </data>
    </outputs>
    <tests>
      <test>
          <param name="input1" value="test1.fasta"/>
          <output name="outputtsv" file="result1.tsv" ftype="tsv" />
          <output name="outputcsv" file="result1.csv" ftype="csv" />
      </test>
      <test>
          <param name="alignment" value="--alignment" />
          <param name="input1" value="test1.fasta" />
          <output name="outputtsv" file="result1.tsv" ftype="tsv" />
          <output name="outputcsv" file="result1.csv" ftype="csv" />
          <output name="align1" file="aln1.fasta" ftype="fasta" />
      </test>
    </tests>
    <help><![CDATA[
        pangolin: Phylogenetic Assignment of Named Global Outbreak LINeages
        
        Pangolin is used to assign a SARS-CoV-2 genome sequence the most likely lineage based on the PANGO nomenclature system.

    ]]></help>
    <citations>
      <citation type="bibtex">
      @misc{githubpangolin,
        author = {O'Toole, √Åine},
        year = {2020},
        title = {pangolin},
        publisher = {GitHub},
        journal = {GitHub repository},
        url = {https://github.com/cov-lineages/pangolin},
      }</citation>
    </citations>
</tool>
