<macros>
    <token name="@MOSDEPTH_COMMAND@"><![CDATA[
        #set $pattern = "coverage depth assessment"
        @LN_FILES@
    ]]></token>

    <xml name="mosdepth_form">
        <repeat name="mosdepth_output" title="Mosdepth output" min="1">
            <conditional name="type">
                <param name="type" type="select" label="Type of Mosdepth output?">
                    <option value="dist">Global or Region Coverage Distribution</option>
                    <option value="summary">Coverage Summary</option>
                </param>
                <when value="dist">
                    <param name="input" type="data" format="tabular" label="global or region coverage output of mosdepth" multiple="true"/>
                </when>
                <when value="summary">
                    <param name="input" type="data" format="tabular" label="summary coverage output of mosdepth" multiple="true"/>
                </when>
            </conditional>
        </repeat>
    </xml>
    <!-- add here your test files and tests, the more stringent the better -->
    <xml name="mosdepth_test">
        <test expect_num_outputs="2">
            <repeat name="results">
                <conditional name="software_cond">
                    <param name="software" value="mosdepth"/>
                    <repeat name="mosdepth_output">
                        <conditional name="type">
                            <param name="type" value="dist"/>
                            <param name="input" value="test.mosdepth.summary.txt"/>
                        </conditional>
                    </repeat>
                    <repeat name="mosdepth_output">
                        <conditional name="type">
                            <param name="type" value="summary"/>
                            <param name="input" value="test.mosdepth.global.dist.txt"/>
                        </conditional>
                    </repeat>
                </conditional>
            </repeat>
            <param name="title" value="Title of the report"/>
            <param name="comment" value="Commment for the report"/>
            <output name="html_report">
                <assert_contents>
                    <has_text text="Title of the report"/>
                    <has_text text="Commment for the report"/>
                    <has_text text="Cumulative coverage distribution"/>
                    <has_text text="Average coverage per contig"/>
                </assert_contents>
            </output>
            <output name="stats">
                <assert_contents>
                    <has_text text="mosdepth-1_x_pc"/>
                    <has_text text="mosdepth-length"/>
                </assert_contents>
            </output>
        </test>
    </xml>
</macros>
